name: scale-hpa
version: "1.0.0"
description: >
  Update the min/max replica bounds of a Horizontal Pod Autoscaler.

parameters:
  - name: namespace
    type: string
    required: true
    description: Kubernetes namespace containing the HPA
  - name: hpa
    type: string
    required: true
    description: Name of the HPA
  - name: min_replicas
    type: integer
    required: true
    description: Minimum number of replicas
    constraints:
      min_value: 1
      max_value: 100
  - name: max_replicas
    type: integer
    required: true
    description: Maximum number of replicas
    constraints:
      min_value: 1
      max_value: 500

risk_class: medium
target_types:
  - k8s-hpa

prechecks:
  - name: hpa-exists
    description: Verify the HPA exists
  - name: min-max-valid
    description: Verify min_replicas <= max_replicas

reversible: true
rollback_action: scale-hpa
required_privileges:
  - "autoscaling/horizontalpodautoscalers:patch"
  - "autoscaling/horizontalpodautoscalers:get"
tags:
  - kubernetes
  - hpa
  - scaling

state_fields:
  - name: min_replicas
    description: Current minimum replica count
    type: integer
    required: true
  - name: max_replicas
    description: Current maximum replica count
    type: integer
    required: true

rollback_params:
  namespace:
    source: params.namespace
  hpa:
    source: params.hpa
  min_replicas:
    source: before_state.min_replicas
  max_replicas:
    source: before_state.max_replicas
